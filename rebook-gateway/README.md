# Rebook Gateway

[![Java](https://img.shields.io/badge/Java-17-ED8B00?style=flat&logo=openjdk&logoColor=white)](https://openjdk.org/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.3.13-6DB33F?style=flat&logo=spring-boot)](https://spring.io/projects/spring-boot)
[![Spring Cloud](https://img.shields.io/badge/Spring%20Cloud-2023.0.5-6DB33F?style=flat&logo=spring)](https://spring.io/projects/spring-cloud)
[![Gradle](https://img.shields.io/badge/Gradle-8.14.2-02303A?style=flat&logo=gradle)](https://gradle.org/)

Rebook λ§μ΄ν¬λ΅μ„λΉ„μ¤ μƒνƒκ³„λ¥Ό μ„ν• API Gateway μ„λΉ„μ¤λ΅, μ¤‘μ•™ν™”λ λΌμ°ν…, JWT μΈμ¦, μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ λ° λ¨λ‹ν„°λ§ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

## π“‹ λ©μ°¨

- [κ°μ”](#κ°μ”)
- [μ£Όμ” κΈ°λ¥](#μ£Όμ”-κΈ°λ¥)
- [μ•„ν‚¤ν…μ²](#μ•„ν‚¤ν…μ²)
- [μ‚¬μ „ μ”κµ¬μ‚¬ν•­](#μ‚¬μ „-μ”κµ¬μ‚¬ν•­)
- [μ‹μ‘ν•κΈ°](#μ‹μ‘ν•κΈ°)
- [μ„¤μ •](#μ„¤μ •)
- [API λΌμ°νΈ](#api-λΌμ°νΈ)

## π― κ°μ”

Rebook Gatewayλ” Rebook λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ²μ—μ„ λ¨λ“  ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ λ‹¨μΌ μ§„μ…μ  μ—­ν• μ„ ν•©λ‹λ‹¤. λ‹¤μ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤:

- **μ¤‘μ•™ν™”λ μΈμ¦**: λ¨λ“  λ‹¤μ΄μ¤νΈλ¦Ό μ„λΉ„μ¤λ¥Ό μ„ν• JWT κΈ°λ° μΈμ¦
- **λ™μ  λΌμ°ν…**: Eurekaλ¥Ό ν†µν• μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ λ° λ΅λ“ λ°Έλ°μ‹±
- **ν”„λ΅ν† μ½ μ§€μ›**: HTTP/REST, WebSocket, Server-Sent Events (SSE)
- **κ΄€μ°°μ„±**: Prometheus λ° Sentryμ™€ ν†µν•©λ λ¨λ‹ν„°λ§
- **CORS κ΄€λ¦¬**: μ„¤μ • κ°€λ¥ν• κµμ°¨ μ¶μ² λ¦¬μ†μ¤ κ³µμ 

## β¨ μ£Όμ” κΈ°λ¥

### μΈμ¦ λ° λ³΄μ•
- π” HMAC-SHA μ„λ…μ„ μ‚¬μ©ν• JWT ν† ν° κ²€μ¦
- π›΅οΈ `X-User-Id` ν—¤λ”λ¥Ό ν†µν• μ‚¬μ©μ μ‹λ³„ μ •λ³΄ μ „ν
- π ν™”μ΄νΈλ¦¬μ¤νΈ κ³µκ° μ—”λ“ν¬μΈνΈ (λ΅κ·ΈμΈ, νμ›κ°€μ…, ν—¬μ¤μ²΄ν¬)
- π”’ λ°μ‘ν• Spring Security μ„¤μ •

### λΌμ°ν… λ° μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬
- π”„ Eureka ν†µν•©μ„ ν†µν• ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ΅λ“ λ°Έλ°μ‹±
- π λ™μ  μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬
- π“΅ WebSocket λ° SSE ν”„λ΅ν† μ½ μ§€μ›
- π― λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅μ κ²½λ΅ κΈ°λ° λΌμ°ν…

### κ΄€μ°°μ„± λ° λ¨λ‹ν„°λ§
- π“ Prometheus λ©”νΈλ¦­ λ…Έμ¶
- π” Sentry μ—λ¬ μ¶”μ  λ° μ•λ¦Ό
- β¤οΈ ν—¬μ¤μ²΄ν¬ μ—”λ“ν¬μΈνΈ
- π“ μ΄μ μΈμ‚¬μ΄νΈλ¥Ό μ„ν• Actuator μ—”λ“ν¬μΈνΈ

## π—οΈ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  ν΄λΌμ΄μ–ΈνΈ  β”‚
β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
       β”‚
       β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚       Rebook Gateway (ν¬νΈ 8080)                  β”‚
β”‚                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ CustomFilter   β”‚β”€β”€β”€β”€β”€β–¶β”‚    JwtUtil       β”‚  β”‚
β”‚  β”‚  (JWT μΈμ¦)    β”‚      β”‚  (ν† ν° κ²€μ¦)     β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚           β”‚                                      β”‚
β”‚           β–Ό                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ SecurityConfig β”‚      β”‚  Eureka Client   β”‚  β”‚
β”‚  β”‚ (ν™”μ΄νΈλ¦¬μ¤νΈ) β”‚      β”‚ (λ””μ¤μ»¤λ²„λ¦¬)     β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
               β”‚
       β”β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”
       β”‚ Eureka Server β”‚
       β”‚    :8761      β”‚
       β””β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
               β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β–Ό          β–Ό          β–Ό          β–Ό          β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”
β”‚  User  β”‚ β”‚ Book β”‚ β”‚ Trading β”‚ β”‚ Chat β”‚ β”‚ Noti β”‚
β”‚ Serviceβ”‚ β”‚Serviceβ”‚ β”‚ Service β”‚ β”‚Serviceβ”‚ β”‚Serviceβ”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”
```

### μ”μ²­ νλ¦„

1. **ν΄λΌμ΄μ–ΈνΈ μ”μ²­** β†’ Gatewayκ°€ 8080 ν¬νΈλ΅ μ”μ²­ μμ‹ 
2. **μΈμ¦** β†’ `CustomFilter`κ°€ JWT ν† ν° μ¶”μ¶ λ° κ²€μ¦
3. **μ‚¬μ©μ μ»¨ν…μ¤νΈ** β†’ ν† ν°μ—μ„ μ‚¬μ©μ IDλ¥Ό μ¶”μ¶ν•μ—¬ `X-User-Id` ν—¤λ”μ— μ¶”κ°€
4. **μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬** β†’ Eurekaκ°€ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤ μ„μΉ ν™•μΈ
5. **λ΅λ“ λ°Έλ°μ‹±** β†’ μ •μƒ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤λ΅ μ”μ²­ λΌμ°ν…
6. **μ‘λ‹µ** β†’ μ„λΉ„μ¤ μ‘λ‹µμ„ ν΄λΌμ΄μ–ΈνΈμ— λ°ν™


#### λ³΄μ• ν™”μ΄νΈλ¦¬μ¤νΈ

κ³µκ° μ—”λ“ν¬μΈνΈ (μΈμ¦ λ¶ν•„μ”):
- `/actuator/**` - ν—¬μ¤μ²΄ν¬ λ° λ©”νΈλ¦­
- `/eureka/**` - μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬
- `/swagger-ui/**` - API λ¬Έμ„
- `/api/auths/**` - μΈμ¦ μ—”λ“ν¬μΈνΈ
- λ¨λ“  μ„λΉ„μ¤ μ—”λ“ν¬μΈνΈ (μΈμ¦μ€ CustomFilterμ—μ„ μ²λ¦¬)

## π›£οΈ API λΌμ°νΈ

### μ„λΉ„μ¤ λΌμ°ν… ν…μ΄λΈ”

| κ²½λ΅ ν¨ν„΄ | λ€μƒ μ„λΉ„μ¤ | ν”„λ΅ν† μ½ | μΈμ¦ |
|----------|------------|---------|------|
| `/api/users/**` | USER-SERVICE | HTTP | ν•„μ |
| `/api/auths/**` | USER-SERVICE | HTTP | κ³µκ° |
| `/api/books/**` | BOOK-SERVICE | HTTP | ν•„μ |
| `/api/tradings/**` | TRADING-SERVICE | HTTP | ν•„μ |
| `/api/notifications/**` | NOTIFICATION-SERVICE | HTTP | ν•„μ |
| `/api/chats/**` | CHAT-SERVICE | HTTP/SSE | ν•„μ |
| `/api/ws-chat/**` | CHAT-SERVICE | WebSocket | μ„ νƒ |


### ν”„λ΅μ νΈ κµ¬μ΅°

```
src/
β”β”€β”€ main/
β”‚   β”β”€β”€ java/com/example/rebookgateway/
β”‚   β”‚   β”β”€β”€ RebookGatewayApplication.java  # λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ…
β”‚   β”‚   β”β”€β”€ CustomFilter.java              # κΈ€λ΅λ² μΈμ¦ ν•„ν„°
β”‚   β”‚   β”β”€β”€ JwtUtil.java                   # JWT κ²€μ¦ μ ν‹Έλ¦¬ν‹°
β”‚   β”‚   β””β”€β”€ SecurityConfig.java            # λ³΄μ• μ„¤μ •
β”‚   β””β”€β”€ resources/
β”‚       β”β”€β”€ application.yaml               # κΈ°λ³Έ μ„¤μ •
β”‚       β”β”€β”€ application-dev.yaml           # κ°λ° ν”„λ΅νμΌ
β”‚       β””β”€β”€ application-prod.yaml          # ν”„λ΅λ•μ… ν”„λ΅νμΌ
β””β”€β”€ test/
    β””β”€β”€ java/                               # ν…μ¤νΈ νμΌ (μ¶”κ°€ μμ •)
```